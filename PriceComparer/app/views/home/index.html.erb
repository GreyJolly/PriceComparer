<!DOCTYPE html>
<html>
	<head>
		<title>Price Comparer</title>
		<meta name="viewport" content="width=device-width,initial-scale=1">
    	<%= csrf_meta_tags %>
    	<%= csp_meta_tag %>
		<%= stylesheet_link_tag "application", media: "all" %>
	</head>

	<body>
		
		<%= render "partials/header" %>
		
		<%= form_with url: search_products_path, method: :get, local: true do %>
  			<div class="field">
    			<%= label_tag :query, "Search" %>
    			<%= text_field_tag :query, params[:query] %>
  			</div>
  					

			<div class="field">
    			<%= label_tag :min_price, "Minimum Price" %>
   				<%= number_field_tag :min_price, params[:min_price], min: 0.01, step: 0.01 %>
  			</div>
  			<div class="field">
    			<%= label_tag :max_price, "Maximum Price" %>
    			<%= number_field_tag :max_price, params[:max_price], min: 0.01, step: 0.01 %>
  			</div>
			
			<label>
    			<%= radio_button_tag :order, "asc", params[:order] == "asc" %>
   	 			Sort by Ascending Price
  			</label>
  			<label>
    			<%= radio_button_tag :order, "desc", params[:order] == "desc" %>
    			Sort by Descending Price
  			</label>

  			<div class="actions"> <%= submit_tag "Search" %> </div>

		<% end %>
		
		 <table>
			<thead>
			<tr>
				<th>Nome</th>
				<th>Descrizione</th>
				<th>Sito</th>
				<th>Prezzo</th>
				<th>Azioni</th>
			</tr>
			</thead>
			<tbody>
			<% (@combined_products || []).each do |product| %>
				<tr>
				<td><%= product.name %></td>
				<td><%= product.description %></td>
				<td><%= product.site %></td>
				<td><%= product.price %></td>
				<% if product.site == 'eBay' %>
					<td><a href="<%= product.url %>">View on eBay</a></td>
				<% end %>
				<% if user_signed_in? %>
							<% if  Wishlist.exists?(product_id: product.id_product, username: current_user.username) %>
								<td><%= button_to "Rimuovi dalla wishlist", remove_from_wishlist_product_path(product), method: :delete %>
							<% else %>
								<td><%= button_to "Aggiungi alla wishlist", add_to_wishlist_product_path(product), method: :post %></td>
							<% end %>			
					<td><%= button_to "Segnala", report_product_path(product), method: :patch %></td>
				<% end %>	
				</tr>
			<% end %>
			</tbody>
		</table>
	
		<h2>Account</h2>
		<% if user_signed_in? %>
			<p>Benvenuto, <%= current_user.username %></p>
			<%= button_to "Edit profile", edit_user_registration_path, method: :get %>
			<%= button_to "Logout", destroy_user_session_path, method: :delete %>
		<% else %>
			<%= link_to "Sign up", new_user_registration_path %> or
			<%= link_to "Login", new_user_session_path %>
		<% end %>
		<br>

	</body>
</html>
